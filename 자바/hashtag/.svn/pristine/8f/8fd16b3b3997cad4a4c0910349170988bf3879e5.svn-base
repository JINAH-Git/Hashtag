<%@ page language="java" contentType="text/html; charset=EUC-KR"
    pageEncoding="EUC-KR"%>
<%@ page import="hashtag.dao.*" %>
<%@ page import="hashtag.dto.*" %>
<%@ page import="hashtag.vo.*" %>
<%@ page import="java.util.*" %>
<%
request.setCharacterEncoding("EUC-KR");

String refine = request.getParameter("refine");
if(refine == null) refine = "원본";
String region = request.getParameter("region");
if(region == null) region = "지역";
String searchVal = request.getParameter("searchVal");
if(searchVal == null) searchVal = "전체";
String keyword = request.getParameter("keyword");
if(keyword == null) keyword = "";
int pageNo = 1;
try
{
	pageNo = Integer.parseInt(request.getParameter("page"));
}catch(Exception e){};
%>
<!DOCTYPE html>
<html>
	<head>
		<meta charset="EUC-KR">
		<title>크롤링한 데이터 확인</title>
		<script src="/hashtag/js/jquery-3.7.0.js"></script>
	</head>
	<body>
		<script>
		window.onload = function()
		{
			$("#keyword").val("<%= keyword %>");
			
			if($("#searchVal").val() == "전체" && $("#keyword").val() != "")
			{
				alert("검색범위를 설정해주세요.");
				return;
			}
		}
		</script>
		<table align="center">
			<tr>
				<td>
					<form action="data.jsp" method="get">
						<select name="refine">
							<option value="원본" <%= refine.equals("원본") ? "selected" : "" %>>원본</option>
							<option value="1차" <%= refine.equals("1차") ? "selected" : "" %>>1차</option>
							<option value="2차" <%= refine.equals("2차") ? "selected" : "" %>>2차</option>
							<option value="3차" <%= refine.equals("3차") ? "selected" : "" %>>3차</option>
							<option value="최종" <%= refine.equals("최종") ? "selected" : "" %>>최종</option>
						</select>
						<select name="region">
							<option value="지역" <%= region.equals("지역") ? "selected" : "" %>>지역</option>
							<option value="전주" <%= region.equals("전주") ? "selected" : "" %>>전주</option>
							<option value="완주" <%= region.equals("완주") ? "selected" : "" %>>완주</option>
							<option value="군산" <%= region.equals("군산") ? "selected" : "" %>>군산</option>
							<option value="익산" <%= region.equals("익산") ? "selected" : "" %>>익산</option>
						</select>
						<select name="searchVal" id="searchVal">
							<option value="전체" <%= searchVal.equals("전체") ? "selected" : "" %>>검색범위</option>
							<option value="제목" <%= searchVal.equals("제목") ? "selected" : "" %>>제목</option>
							<option value="내용" <%= searchVal.equals("내용") ? "selected" : "" %>>내용</option>
							<option value="해시태그" <%= searchVal.equals("해시태그") ? "selected" : "" %>>해시태그</option>
						</select>
						<input type="text" name="keyword" id="keyword" placeholder="키워드를 입력하세요.">
						<input type="submit" value="검색">
					</form>
				</td>
			</tr>
		</table>
		<%
		DataDTO dto = new DataDTO();
		int totalData = dto.GetTotalData(refine,region,searchVal,keyword);
		%>
		<p style="text-align: center; font-size: 20px; color: blue;">수집한 데이터 중 입력하신 조건(정제차수:<b style="color: red"><%= refine %></b>,지역:<b style="color: red"><%= region %></b>,검색범위:<b style="color: red"><%= searchVal %></b>,검색어:<b style="color: red"><%= keyword %></b>)의 데이터는 총 <b style="color: red"><%= totalData %></b>개입니다.</p>
		<table align="center" border="1" style="width: 1300px; text-align: center; table-layout: fixed; margin-top: 50px; font-size: 12px">
			<tr>
				<th width="100px">블로그주소</th>
				<th width="50px">정제차수</th>
				<th width="100px">제목</th>
				<th width="100px">작성일</th>
				<th width="500px">내용</th>
				<th width="200px">해시태그</th>
				<th width="50px">공감수</th>
				<th width="50px">지역명</th>
				<th width="50px">형용사</th>
			</tr>
			<%
			DataDTO dto2 = new DataDTO();
			ArrayList<DataVO> list = dto2.List(refine,region,searchVal,keyword,pageNo);
			for(DataVO vo:list)
			{
				%>
				<tr>
					<td style="overflow: hidden; text-overflow: inherit;"><a href="<%= vo.getBlogaddress()%>"><%= vo.getBlogaddress() %></a></td>
					<td><%= vo.getRefine() %></td>
					<td style="font-size: 10px;"><%= vo.getTitle() %></td>
					<td><%= vo.getWdate() %></td>
					<td><textarea cols="71" rows="8" style="resize: none; outline: none; " readonly><%= vo.getNote() %></textarea></td>
					<td style="font-size: 10px;"><%= vo.getCdhashtag() %></td>
					<td><%= vo.getAgreecount() %></td>
					<td><%= vo.getCdregion() %></td>
					<td style="font-size: 10px;"><%= vo.getCdadjective() %></td>
				</tr>
				<%
			}
			%>
		</table>
		<table align="center" border="1" style="width: 1300px; margin-top: 10px; text-align: center;">
			<tr>
				<td>
				<%
				//마지막 페이지 설정
				int endPage = (int)(totalData / 10) + 1;
				if(endPage % 10 == 0) endPage--;
				//화면에 보이는 페이지 숫자의 개수 설정
				int displayNum = 20; 
				//화면에 보이는 페이지 숫자 중 시작번호
				int startBlock = pageNo - (pageNo % displayNum) + 1 ;
				if(pageNo % 20 == 0) startBlock = startBlock - displayNum;
				//화면에 보이는 페이지 숫자 중 끝번호
				int endBlock = startBlock + displayNum - 1;
				if(endBlock >= endPage) endBlock = endPage;
				//화면에 보일 페이지 구현
				if(startBlock != 1)
				{
					%>
					<a href="data.jsp?refine=<%= refine %>&region=<%= region %>&searchVal=<%= searchVal %>&keyword=<%= keyword %>&page=1">시작</a>
					<a href="data.jsp?refine=<%= refine %>&region=<%= region %>&searchVal=<%= searchVal %>&keyword=<%= keyword %>&page=<%= startBlock-1 %>">이전</a>
					<%
				}
				for(int i = startBlock; i <= endBlock; i++)
				{
					if(pageNo == i)
					{
						%>
						<a href="data.jsp?refine=<%= refine %>&region=<%= region %>&searchVal=<%= searchVal %>&keyword=<%= keyword %>&page=<%= i %>" style="color: red; font-weight: bold;"><%= i %></a>
						<%
					}else
					{
						%>
						<a href="data.jsp?refine=<%= refine %>&region=<%= region %>&searchVal=<%= searchVal %>&keyword=<%= keyword %>&page=<%= i %>"><%= i %></a>
						<%
					}
				}
				if(endBlock != endPage)
				{
					%>
					<a href="data.jsp?refine=<%= refine %>&region=<%= region %>&searchVal=<%= searchVal %>&keyword=<%= keyword %>&page=<%= endBlock+1 %>">다음</a>
					<a href="data.jsp?refine=<%= refine %>&region=<%= region %>&searchVal=<%= searchVal %>&keyword=<%= keyword %>&page=<%= endPage %>">마지막</a>
					<%
				}
				%>
				</td>
			</tr>
		</table>
	</body>
</html>