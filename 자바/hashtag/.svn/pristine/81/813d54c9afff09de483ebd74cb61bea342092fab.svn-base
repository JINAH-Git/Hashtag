//크롤링한 데이터 정보를 모델(Model)로 부터 처리하기 위한 DTO클래스(Data Transfer Object)
package hashtag.dto;

import java.util.ArrayList;

import hashtag.dao.*;
import hashtag.vo.*;

public class DataDTO extends DBManager
{	
	//조건에 맞는 데이터의 개수 구하기 - R
	public int GetTotalData(String refine,String region,String searchVal,String keyword)
	{
		
		int totalData = 0;
		
		if(searchVal.equals("제목")) searchVal = "title";
		if(searchVal.equals("내용")) searchVal = "note";
		if(searchVal.equals("해시태그")) searchVal = "cdhashtag";
		
		this.DBOpen();
		String sql = "";
		sql  = "select count(*) as total from crawlingdata ";
		sql += "where refine='" + refine + "' ";
		if(!region.equals("지역"))
		{
			sql += "and cdregion='" + region + "' ";			
		}
		if(!searchVal.equals("전체"))
		{
			sql += "and " + searchVal + " like '%" + keyword +"%' ";			
		}
		this.RunSelect(sql);
		System.out.println(sql);
		if(this.Next() == true)
		{
			totalData = Integer.parseInt(this.getValue("total"));
		}
		this.DBClose();
		
		return totalData;
	}
	
	//조건에 맞게 리스트 출력하기 - R
	public ArrayList<DataVO> List(String region,String searchVal,String keyword,int pageNo)
	{
		if(searchVal.equals("제목")) searchVal = "title";
		if(searchVal.equals("내용")) searchVal = "note";
		if(searchVal.equals("해시태그")) searchVal = "cdhashtag";
		
		this.DBOpen();
		DataVO vo = null;
		ArrayList<DataVO> list = new ArrayList<DataVO>();
		int startNo = (pageNo - 1) * 10;
		String sql = "";
		sql  = "select * from crawlingdata ";
		sql += "where 1 = 1 ";
		if(!region.equals("지역"))
		{
			sql += "and cdregion='" + region + "' ";			
		}
		if(!searchVal.equals("전체"))
		{
			sql += "and " + searchVal + " like '%" + keyword +"%' ";			
		}
		sql += "limit " + startNo + ",10 ";
		this.RunSelect(sql);
		System.out.println(sql);
		while(this.Next() == true)
		{
			vo = new DataVO();
			vo.setCdblogaddress(this.getValue("blogaddress"));
			vo.setCdtitle(this.getValue("title"));
			vo.setCdwdate(this.getValue("wdate"));
			vo.setCdwdate(this.getValue("note"));
			vo.setCdhashtag(this.getValue("cdhashtag"));
			vo.setCdheart(this.getValue("agreecount"));
			vo.setCdregion(this.getValue("cdregion"));
			list.add(vo);
		}
		this.DBClose();
		
		return list;	
	}
}
